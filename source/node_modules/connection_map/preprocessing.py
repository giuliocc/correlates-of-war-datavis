import json

file1 = "inter_war_data.json"
file2 = "cshapes.json"

with open(file1, 'r') as f:
	war = json.load(f)
	data1 = war["war_data"]

with open(file2, 'r') as f:
	shapes = json.load(f)
	data2 = shapes["features"]

# print(data[1])
j = 0
rem = []
for i in range(len(data2)):
	if (data2[i-j]['properties']['COWCODE'] == -1 or data2[i-j]['properties']['COWEYEAR'] != 2016):
		p = data2.pop(i-j)
		rem.append(p['properties']['COWCODE'])
		j += 1

# print(str(j) + " has been removed")

keys = ["GWCODE", "COWSYEAR", "COWSMONTH", "COWSDAY", "COWEYEAR", "COWEMONTH", "COWEDAY", "FEATUREID", "AREA", "CAPNAME", "CAPLONG", "CAPLAT", "GWSYEAR", "GWSMONTH", "GWSDAY", "GWEYEAR", "GWEMONTH", "GWEDAY", "ISONAME", "ISO1NUM", "ISO1AL2", "ISO1AL3"]

for obj in data2:
	for k in keys:
		del obj['properties'][k]

data2.sort(key = lambda x: x['properties']['CNTRY_NAME'])

for obj in data2:
	print(obj['properties'])

cow_codes = list(map(lambda x: x['properties']['COWCODE'], data2))

# print(cow_codes)
out = []
for w in data1:
	if (w['ccode'] not in cow_codes):
		# print(w['state_name'] + ": " + str(w['ccode']))
		out.append(w['ccode'])

# print(set(out))
# print(set(rem))

wars = list(filter(lambda x: x['ccode'] not in set(rem), data1))

connect = []
for obj in data2:
	c = obj['properties']['COWCODE']
	w = list(map(lambda x: x['war_id'], filter(lambda x: x['ccode'] == c, wars)))
	e = list(set(map(lambda x: x['ccode'], filter(lambda x: x['war_id'] in w and x['ccode'] != c, wars))))
	connect.append({'code': c, 'wars': w, 'enemies': e})
	# print(obj['properties'])

outf = json.dumps(connect)
# outf = json.dumps({"type":"FeatureCollection","features":data2})
# print(outf)


with open("war_connect.json", 'w') as f:
	f.write(outf)

